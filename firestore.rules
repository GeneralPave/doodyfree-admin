rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    function isAuthed() { return request.auth != null; }
    function isAdmin() { return isAuthed() && request.auth.token.admin == true; }
    function isEmployee() { return isAuthed() && request.auth.token.role == 'employee'; }

    match /customers/{cid} {
      allow read, write: if isAdmin();
    }

    match /employees/{eid} {
      allow read, write: if isAdmin();
      allow read: if isEmployee() && request.auth.uid == eid;
    }

    match /assignments/{aid} {
      allow read, write: if isAdmin();
      allow read: if isEmployee() && resource.data.employee_id == request.auth.uid;
    }

    match /cleans/{id} {
      allow read, write: if isAdmin();
      allow create, read: if isEmployee() && request.resource.data.employee_id == request.auth.uid;
      allow update: if isEmployee() && resource.data.employee_id == request.auth.uid;
    }

    match /subscriptions/{id} { allow read, write: if isAdmin(); }
    match /employee_rates/{id} {
      allow read, write: if isAdmin();
      allow read: if isEmployee() && resource.data.employee_id == request.auth.uid;
    }
    match /work_logs/{id} {
      allow read, write: if isAdmin();
      allow read, write: if isEmployee() && (request.resource.data.employee_id == request.auth.uid || resource.data.employee_id == request.auth.uid);
    }
    match /subscription_plans/{id} {
      allow read: if isAuthed();
      allow write: if isAdmin();
    }
  }
}